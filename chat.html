<!DOCTYPE html>

<html lang="en">

<head>

	<meta charset="UTF-8">

	<title>Chat</title>

	<script src="https://cdn.jsdelivr.net/npm/vue/dist/vue.js"></script>

	<script src="socket.io/socket.io.js"></script>
	<link rel="stylesheet" href="_css/style.css">

</head>

<body>
<!-- 	<div id="chat">
		<form @submit.prevent = "sendMessage" >
			<ul class="messageList">
				<template v-for="message in messages">
					<li :class="message.class">{{message.message}}</li>
				</template>
			</ul>
			<input type="text" v-model:value="message">
			<input type="submit" value="send" />
		</form>
	</div> -->
<div class="chat" id="chat" style="color: rgb(0, 0, 0);">
			<div class="princess-furniture-messages-block chat-messages" style="color: rgb(0, 0, 0);">
				<div class="avatar princess-furniture-avatar"></div>
				<div class="message-bubble princess-furniture-message">
					–ö—Å—Ç–∞—Ç–∏, —Ç—É—Ç&nbsp;–º–æ–∂–Ω–æ&nbsp;—É—Ç–æ—á–Ω–∏—Ç—å&nbsp;–¥–µ—Ç–∞–ª–∏
				</div>
				<div class="message-bubble princess-furniture-message big-text last-message">
					–û—Ç–≤–µ—á–∞–µ–º —Å—Ä–∞–∑—É&nbsp;üôÇ
				</div>
			</div>
			<template v-for="(message,index) in messages">
				<template v-if="index==(messages.length-1)">
					<div class="chat-messages" :class="message.class+'-block big-text'">
						<div :class="'message-bubble '+message.class+'-message'">
						{{message.message.trim()}}
						</div>
					</div>
				</template>
				<template v-else>
					<div class="chat-messages" :class="message.class+'-block'">
						<div :class="'message-bubble '+message.class+'-message'">
						{{message.message}}
						</div>
					</div>
				</template>
			</template>
				<form @submit.prevent = "sendMessage">
					<div class="message-editor">
					<div class="avatar user-avatar"></div>
					<textarea v-on:keyup.enter.stop.prevent="sendMessage" placeholder="–ú–µ—Å—Ç–æ –¥–ª—è –≤–æ–ø—Ä–æ—Å–∞" v-model:value="message" style="color: rgb(0, 0, 0);"></textarea>
				</div>
				</form>
		</div>
</body>

<script type="text/javascript">

	// window.addEventListener('load', function(){

		var app=new Vue(
			{el:'#chat',
			data: {
				messages:[],
				message:'',
				connected:0,
				userID:sessionStorage.setItem('userID', this.userID) || Date.now()
			},
			methods:{
				sendMessage:function(){
					if (this.message.trim()!=='') {
						socket.emit('message',{
							message:this.message.trim(),
							owner:this.userID})
						this.message='';	
					}
					else 
						this.message=''
				}
			},
			created:function(){
			socket=io();
			sessionStorage.setItem('onwer',this.owner)
			},

			mounted:function()
			{
				socket.on('message', function(message)
				{
					if (message.owner==app.userID)
						message.class='user';
					else 
						message.class='princess-furniture';
					app.messages.push(message);
				}),
				socket.on('connected', function(message)
				{
					app.connected++;
				})
			}

		})

	// })

</script>

</html>