<!DOCTYPE html>

<html lang="en">

<head>

	<meta charset="UTF-8">

	<title>Chat - Admin</title>

	<script src="https://cdn.jsdelivr.net/npm/vue/dist/vue.js"></script>

	<script src="socket.io/socket.io.js"></script>
	<link rel="stylesheet" href="_css/style.css">

	<script type="text/x-template" id="dialogTemplate">
  	<div class="chat" >
  		<div class="princess-furniture-messages-block chat-messages">
			<template v-for="(message,index) in messages">
				<template v-if="index==(messages.length-1)">
					<div class="chat-messages" :class="message.class+'-block big-text'">
						<div :class="'message-bubble '+message.class+'-message'">
						{{message.message}}
						</div>
					</div>
				</template>
				<template v-else>
					<div class="chat-messages" :class="message.class+'-block'">
						<div :class="'message-bubble '+message.class+'-message'">
						{{message.message}}
						</div>
					</div>
				</template>
			</template>
		</div>
	</div>	
</script>
</head>

	<body>

<div id="chat" >
		<dialog1
			v-for="dialog in dialogs"
  			:from="dialog.user"
  			:message="dialog.messages"
  			:key="dialog.user"
		></dialog1>
</div>
</body>

<script type="text/javascript">

	// window.addEventListener('load', function(){

		var app=new Vue(
			{el:'#chat',
			data: {
				connected:0,
				userID:777,
				dialogs:[],
				pointer:0
			},
			methods:{
				sendMessage:function(user){
				}
			},
			created:function(){
				socket=io();
				sessionStorage.setItem('onwer',this.userID);
			},
			mounted:function()
			{
				socket.on('message', function(message)
				{
					if (message.owner!=777) {
						console.log('1');
						var isFound=false;
						for (let i=0;i<app.dialogs.length;i++) {	
							if (app.dialogs[i].user===message.owner) {
								console.log(message);
								app.dialogs[i].messages.push(message);
								isFound=true;
								break;
							}
						}
						if (isFound==false){	
							app.dialogs.push({'user':message.owner, 'messages':[message]});
						}
					} //message.owner!=777
					else {
						dialogs[message.userIndex].messages.push(message);
						
					}
				})
			}
		})
	
		Vue.component('dialog1',{
			data:function()
			{
				return {
					// messages:[],
					// message:'',
					// fromID:0,
					// online:true
				}
			},
			props:{
				from: Number,
				messages: Array
			},
			template:'#dialogTemplate'})

	// })

</script>

</html>